<html>
    <head>
        <title>Planetary gravity</title>
        <style type="text/css">
            * {
                margin: 0;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript" src="../examples/js/THREE-r60.min.js"></script>
        <script type="text/javascript" src="../examples/js/Stats.min.js"></script>

        <script type="text/javascript">
            var scene = new THREE.Scene(),
                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000),
                renderer = new THREE.WebGLRenderer(),

                planet = new THREE.Mesh( new THREE.SphereGeometry(10, 16, 16), new THREE.MeshPhongMaterial() ),
                planetMass = 100000,

                orbiter = new THREE.Mesh( new THREE.SphereGeometry(2, 16, 16), new THREE.MeshPhongMaterial() ),
                orbiterMass = 500,

                orbiterAcceleration = new THREE.Vector3(0, 0, 0),
                orbiterVelocity = new THREE.Vector3(-0.3, 0, 0),

                stats = new Stats(),
                clock = new THREE.Clock(),

                light = new THREE.DirectionalLight(0x999999),

                G = 6.67384,
                m1 = planetMass,
                m2 = orbiterMass,
                m12 = m1 * m2,
                distVector = new THREE.Vector3();

            stats.domElement.style.position = 'absolute';
            stats.domElement.style.top = '0';

            camera.position.set( 0, 150, 0 );
            camera.lookAt( scene.position );
            camera.rotation.z = -Math.PI*2;
            orbiter.position.set(50, 50, 50 );

            light.position = camera.position;

            renderer.autoClear = true;
            renderer.setClearColor(0x000000);
            renderer.setSize(window.innerWidth, window.innerHeight)

            scene.add( camera );
            scene.add( light );
            scene.add( planet );
            scene.add( orbiter );

            document.body.appendChild( renderer.domElement );
            document.body.appendChild( stats.domElement );


            function animate() {
                requestAnimationFrame( animate );
                update();
                render();
            }



            function update() {
                // Fgrav = G • m1 • m2 / d2

                distVector.set(
                    orbiter.position.x - planet.position.x,
                    orbiter.position.y - planet.position.y,
                    orbiter.position.z - planet.position.z
                );

                var r1 = planet.position;
                var r2 = orbiter.position;
                var r12 = distVector;

                var r12Squared = (r12.x * r12.x) + (r12.y * r12.y) + (r12.z * r12.z);

                r12.normalize();
                
                var cached = -( G * m2 / r12Squared );

                var a12 = new THREE.Vector3(
                    cached * r12.x,
                    cached * r12.y,
                    cached * r12.z
                );

                a12.divideScalar(100);

                // console.log( force );

                orbiterAcceleration.copy(a12).divideScalar(1000);

                orbiterVelocity.add(a12);
                orbiter.position.add( orbiterVelocity );
            }

            function render() {
                renderer.render( scene, camera );
            }


            animate();
        </script>

    </body>
</html>