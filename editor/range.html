<!DOCTYPE html>
<html>
    <head>
        <title></title>

        <style type="text/css">
            * {
                margin: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Lucida Grande", sans-serif;
                font-size: 62.5%;
                background: #222;
            }

            .range-slider {
                position: absolute;
                top: 50%;
                left: 25%;
                width: 50%;
                height: 20%;
                background-color: #223645;
                box-shadow: inset 0 2px 3px rgba( 0, 0, 0, 0.6 );
                overflow: hidden;
                -webkit-user-select: none;
                border: 1px solid #1c2d3a;
                border-top: 1px solid #142029;
                border-bottom: 1px solid #233948;
            }


            .slider-handle {
                position: absolute;
                width: 100%;
                height: 100%;
            }

            .slider-value {
                position: absolute;
                top: 0;
                background-color: #446e8c;
                box-shadow: 2px 0 3px rgba( 0, 0, 0, 0.5 ), inset 0 0 2px rgba( 0, 0, 0, 0.5 );
                /*border: 1px solid rgba( 95, 153, 195, 0.3 );*/
            }

            .slider-readout {
                position: absolute;
                top: 0;
                left: 0;
                text-align: center;
                font-weight: lighter;
                color: rgba( 200, 200, 200, 0.9 );
                z-index: 2;
                text-shadow: 0 1px 0px rgba(0, 0, 0, 0.6);
                font-size: 1.3em;
            }
        </style>
    </head>
    <body>
        <script type="text/javascript" src="res/js/vendor/THREE-r65.min.js"></script>
        <script type="text/javascript">
            var Slider = function( options ) {
                this.options = {
                    parent: document.body,
                    width: 150,
                    height: 25,
                    handleWidth: 20,
                    handleHeight: 20,
                    className: 'range-slider',
                    orientation: 'horizontal',

                    fromValue: -100,
                    toValue: 100,
                    startValue: 50
                };

                if( options ) {
                    for( var i in options ) {
                        this.options[ i ] = options[ i ];
                    }
                }

                this.HAS_TOUCH = null;
                this.START_EVENT = null;
                this.MOVE_EVENT = null;
                this.END_EVENT = null;


                this.value = typeof this.options.startValue === 'number' ?
                    this.options.startValue :
                    Math.min(this.options.fromValue, this.options.toValue) + (Math.abs(this.options.toValue - this.options.fromValue) / 2);

                this.internalValue = this._scaleValue(
                    this.value,
                    this.options.fromValue,
                    this.options.toValue,
                    0,
                    this.options.orientation === 'horizontal' ? this.options.width : this.options.height
                );

                this.offsetX = null;
                this.offsetY = null;

                this.active = 0;
                this.x = 0;
                this.y = 0;
                this.startX = 0;
                this.startY = 0;

                this.callbacks = [];


                // Bind scope
                this._onTouchstart = this._onTouchstart.bind( this );
                this._onTouchmove = this._onTouchmove.bind( this );
                this._onTouchend = this._onTouchend.bind( this );

                this._determineInputTypes();
                this._make();
                this._scaleValue();
                this._positionHandle();

                this.enableInteraction();
            };

            Slider.prototype = {
                _determineInputTypes: function() {
                    var hasTouch = this.HAS_TOUCH = 'ontouchstart' in window;
                    this.START_EVENT = hasTouch ? 'touchstart' : 'mousedown';
                    this.MOVE_EVENT = hasTouch ? 'touchmove' : 'mousemove';
                    this.END_EVENT = hasTouch ? 'touchend' : 'mouseup';
                },

                _getPositionForAxis: function( e, axis ) {
                    if( this.offsetX === null ) {
                        this._calculateOffset();
                    }

                    axis = axis.toUpperCase();

                    var offset = this['offset' + axis];

                    return this.HAS_TOUCH ?
                        e.touches[0][ 'page' + axis ] - offset:
                        e[ 'page' + axis ] - offset;
                },

                _make: function() {
                    this.wrapper = document.createElement( 'div' );
                    this.handle = document.createElement( 'div' );
                    this.valueSlider = document.createElement( 'div' );
                    this.readout = document.createElement( 'div' );

                    this.wrapper.className = this.options.className;
                    this.handle.className = 'slider-handle';
                    this.valueSlider.className = 'slider-value';
                    this.readout.className = 'slider-readout';

                    this.wrapper.style.width = this.options.width + 'px';
                    this.wrapper.style.height = this.options.height + 'px';

                    this.handle.style.width = this.options.handleWidth + 'px';
                    this.handle.style.height = this.options.handleHeight + 'px';
                    this.handle.style.marginLeft = (-this.options.handleWidth/2) + 'px';
                    this.handle.style.marginTop = (-this.options.handleHeight/2) + 'px';

                    this.valueSlider.style.height = this.options.height + 'px';

                    this.readout.style.width = this.options.width + 'px';
                    this.readout.style.height = this.readout.style.lineHeight = this.options.height + 'px';

                    if( this.options.orientation === 'horizontal' ) {
                        this.handle.style.top = '50%';
                    }
                    else {
                        this.handle.style.left = '50%';
                    }

                    this._positionHandle();

                    this.wrapper.appendChild( this.handle );
                    this.wrapper.appendChild( this.valueSlider );
                    this.wrapper.appendChild( this.readout );
                    this.options.parent.appendChild( this.wrapper );
                },

                _calculateOffset: function() {
                    this.offsetX = 0;
                    this.offsetY = 0;

                    var el = this.wrapper;

                    while( el !== document.body ) {
                        this.offsetX += el.offsetLeft;
                        this.offsetY += el.offsetTop;
                        el = el.parentNode;
                    }
                },

                _positionHandle: function() {
                    var isHorz = this.options.orientation === 'horizontal',
                        x = isHorz ? this.internalValue : 0,
                        y = isHorz ? 0 : this.internalValue;

                    this.handle.style.webkitTransform = 'translate3d(' + x + 'px, ' + y + 'px, 0)';
                    this.valueSlider.style.width = x + 'px';

                    this.readout.textContent = this.value.toFixed(2);
                },

                _clampInternalValue: function() {
                    this.internalValue = Math.min(
                        this.options.orientation === 'horizontal' ? this.options.width : this.options.height,
                        Math.max( 0, this.internalValue )
                    );
                },

                _determineValue: function( x, y ) {
                    if( this.options.orientation === 'horizontal' ) {
                        this.internalValue = x;
                    }
                    else {
                        this.internalValue = y;
                    }

                    this._clampInternalValue();

                    this.value = this._scaleValue(
                        this.internalValue,
                        0,
                        this.options.orientation === 'horizontal' ? this.options.width : this.options.height,
                        this.options.fromValue,
                        this.options.toValue
                    );

                    this._positionHandle();

                    for( var i = 0; i < this.callbacks.length; ++i ) {
                        this.callbacks[i]( this.value );
                    }
                },

                _scaleValue: function( num, lowIn, highIn, lowOut, highOut ) {
                    return ((num - lowIn) / (highIn - lowIn)) * (highOut - lowOut) + lowOut;
                },

                _onTouchstart: function( e ) {
                    this.active = 1;

                    this.startX = this._getPositionForAxis( e, 'x' );
                    this.startY = this._getPositionForAxis( e, 'y' );

                    this._determineValue( this.startX, this.startY);
                },

                _onTouchmove: function( e ) {
                    if( !this.active ) return;

                    e.preventDefault();

                    var x = this._getPositionForAxis( e, 'x' ),
                        y = this._getPositionForAxis( e, 'y' );

                    this._determineValue( x, y );
                },

                _onTouchend: function( e ) {
                    if( !this.active ) return;
                    this.active = 0;
                },

                enableInteraction: function() {
                    this.wrapper.addEventListener( this.START_EVENT, this._onTouchstart, false );
                    this.handle.addEventListener( this.START_EVENT, this._onTouchstart, false );
                    document.addEventListener( this.MOVE_EVENT, this._onTouchmove, false );
                    document.addEventListener( this.END_EVENT, this._onTouchend, false );
                },

                disableInteraction: function() {
                    this.wrapper.removeEventListener( this.START_EVENT, this._onTouchstart, false );
                    this.handle.removeEventListener( this.START_EVENT, this._onTouchstart, false );
                    document.removeEventListener( this.MOVE_EVENT, this._onTouchmove, false );
                    document.removeEventListener( this.END_EVENT, this._onTouchend, false );
                },

                registerCallback: function( fn ) {
                    this.callbacks.push( fn );
                }
            };

            var slider = new Slider();

            console.log( slider );
        </script>
    </body>
</html>